---
title: baseline
sidebar_position: 4
---

# bellwether baseline

Manage baselines for drift detection.

## Synopsis

```bash
bellwether baseline save [path]
bellwether baseline compare <path>
bellwether baseline show [path]
bellwether baseline diff <path1> <path2>
bellwether baseline migrate [path]
```

## Description

The `baseline` command group manages baselines for detecting structural drift in your MCP server. Baselines capture the server's tool schemas at a point in time, enabling comparison against future checks.

## Subcommands

### save

Save check results as a baseline for drift detection.

```bash
bellwether baseline save [path]
```

| Option | Description | Default |
|:-------|:------------|:--------|
| `[path]` | Output path for baseline file | `bellwether-baseline.json` |
| `-c, --config <path>` | Path to config file | `bellwether.yaml` |
| `--report <path>` | Path to check report JSON file | `bellwether-check.json` |
| `--cloud` | Save in cloud-compatible format | `false` |
| `--contract` | Create contract-only baseline | `false` |
| `-f, --force` | Overwrite existing baseline | `false` |

**Examples:**

```bash
# Save baseline from last check run
bellwether baseline save

# Save to specific path
bellwether baseline save ./baselines/v1.0.0.json

# Save in cloud format for upload
bellwether baseline save --cloud

# Overwrite existing baseline
bellwether baseline save --force
```

:::info Requires Check Report
The `save` command reads from the JSON report generated by `bellwether check`. The check command always generates `bellwether-check.json`.
:::

### compare

Compare check results against an existing baseline.

```bash
bellwether baseline compare <baseline-path>
```

| Option | Description | Default |
|:-------|:------------|:--------|
| `<baseline-path>` | Path to baseline file to compare against | Required |
| `-c, --config <path>` | Path to config file | `bellwether.yaml` |
| `--report <path>` | Path to check report JSON file | `bellwether-check.json` |
| `--format <format>` | Output format: `text`, `json`, `markdown`, `compact` | `text` |
| `--fail-on-drift` | Exit with error if drift is detected | `false` |
| `--ignore-version-mismatch` | Proceed even if format versions are incompatible | `false` |

**Examples:**

```bash
# Compare against baseline
bellwether baseline compare ./bellwether-baseline.json

# Fail if drift detected (for CI/CD)
bellwether baseline compare ./bellwether-baseline.json --fail-on-drift

# Output in JSON format
bellwether baseline compare ./baseline.json --format json

# Compare with custom report location
bellwether baseline compare ./baseline.json --report ./output/bellwether-check.json
```

### show

Display the contents of a baseline file.

```bash
bellwether baseline show [path]
```

| Option | Description | Default |
|:-------|:------------|:--------|
| `[path]` | Path to baseline file | `bellwether-baseline.json` |
| `-c, --config <path>` | Path to config file | `bellwether.yaml` |
| `--json` | Output raw JSON | `false` |
| `--tools` | Show only tool fingerprints | `false` |
| `--assertions` | Show only assertions | `false` |

**Examples:**

```bash
# Show default baseline
bellwether baseline show

# Show specific baseline
bellwether baseline show ./baselines/v1.0.0.json

# Output raw JSON
bellwether baseline show --json

# Show only tools
bellwether baseline show --tools
```

### diff

Compare two baseline files directly.

```bash
bellwether baseline diff <path1> <path2>
```

| Option | Description | Default |
|:-------|:------------|:--------|
| `<path1>` | Path to first baseline file | Required |
| `<path2>` | Path to second baseline file | Required |
| `--format <format>` | Output format: `text`, `json`, `markdown`, `compact` | `text` |
| `--ignore-version-mismatch` | Proceed even if format versions are incompatible | `false` |

**Examples:**

```bash
# Compare two baselines
bellwether baseline diff v1.0.0.json v1.1.0.json

# Output as markdown
bellwether baseline diff old.json new.json --format markdown

# Output as JSON for parsing
bellwether baseline diff old.json new.json --format json
```

### migrate

Migrate a baseline to the current format version.

```bash
bellwether baseline migrate [path]
```

| Option | Description | Default |
|:-------|:------------|:--------|
| `[path]` | Path to baseline file | `bellwether-baseline.json` |
| `--dry-run` | Show what would change without writing | `false` |
| `--info` | Show migration info without performing migration | `false` |
| `-o, --output <path>` | Output path (default: overwrite input) | Input path |
| `-f, --force` | Overwrite output file without prompting | `false` |

**Examples:**

```bash
# Check if migration is needed
bellwether baseline migrate ./baseline.json --info

# Preview migration without writing
bellwether baseline migrate ./baseline.json --dry-run

# Migrate baseline (overwrites input file)
bellwether baseline migrate ./baseline.json

# Migrate to a new file
bellwether baseline migrate ./old.json --output ./new.json

# Force overwrite existing output file
bellwether baseline migrate ./baseline.json --output ./other.json --force
```

## Workflow

### Initial Setup

```bash
# 1. Create config
bellwether init

# 2. Run check
bellwether check npx @mcp/your-server

# 3. Save baseline
bellwether baseline save
```

### CI/CD Integration

```bash
# In your CI pipeline:

# 1. Run check
bellwether check

# 2. Compare against committed baseline
bellwether baseline compare ./bellwether-baseline.json --fail-on-drift
```

Or in one command:

```bash
bellwether check --baseline ./bellwether-baseline.json --fail-on-drift
```

### Version Comparison

```bash
# Compare baselines from different versions
bellwether baseline diff ./baselines/v1.0.0.json ./baselines/v2.0.0.json
```

## Baseline Contents

A baseline file captures:

| Component | Description |
|:----------|:------------|
| **Server Info** | Name, version, protocol version, capabilities |
| **Tools** | Name, description, schema hash |
| **Security Notes** | Security observations per tool |
| **Limitations** | Known limitations per tool |
| **Integrity Hash** | Hash for detecting file tampering |

### Sample Baseline Structure

```json
{
  "version": "0.14.0",
  "createdAt": "2024-01-15T10:30:00Z",
  "serverCommand": "npx @mcp/your-server",
  "mode": "contract",
  "integrityHash": "abc123...",
  "server": {
    "name": "your-server",
    "version": "1.0.0",
    "protocolVersion": "2024-11-05",
    "capabilities": ["tools", "prompts"]
  },
  "tools": [
    {
      "name": "read_file",
      "description": "Read contents of a file",
      "schemaHash": "def456...",
      "securityNotes": ["Path traversal possible"],
      "limitations": ["Cannot read binary files"]
    }
  ],
  "assertions": [],
  "workflowSignatures": [],
  "summary": "File system server with read capabilities"
}
```

## Drift Detection

When comparing baselines, Bellwether detects:

| Change Type | Severity | Description |
|:------------|:---------|:------------|
| Tool added | Info | New tool appeared |
| Tool removed | Breaking | Existing tool disappeared |
| Schema changed | Warning/Breaking | Tool parameters changed |
| Description changed | Info | Tool help text updated |

### Severity Levels

- **None**: No changes detected
- **Info**: Non-breaking changes (additions, cosmetic updates)
- **Warning**: Potentially breaking changes (schema modifications)
- **Breaking**: Definitely breaking changes (removals, incompatible changes)

## Exit Codes

| Code | Meaning |
|:-----|:--------|
| `0` | Success / No drift |
| `1` | Drift detected (with `--fail-on-drift`) |

## Configuration

Baseline settings can be configured in `bellwether.yaml`:

```yaml
# bellwether.yaml
baseline:
  # Default path for baseline file (used by save/compare when no path specified)
  path: "./bellwether-baseline.json"

  # Path to baseline for comparison (used by check --baseline)
  comparePath: "./bellwether-baseline.json"

  # Fail if drift is detected (for CI/CD)
  failOnDrift: true
```

| Setting | Description | Default |
|:--------|:------------|:--------|
| `baseline.path` | Default baseline file path | `bellwether-baseline.json` |
| `baseline.comparePath` | Baseline to compare against during check | - |
| `baseline.failOnDrift` | Exit with error if drift detected | `false` |

### Contract-Only Mode

The `--contract` flag creates a lightweight baseline containing only structural data (no behavioral exploration results). This is useful for:

- **CI/CD pipelines**: Smaller files, faster comparisons
- **Version control**: Clean diffs, smaller commits
- **Check command**: Contract-only is the default for `bellwether check`

Contract-only baselines contain:
- Tool schemas and fingerprints
- Server capabilities
- Integrity hashes

They exclude:
- Interview results (from `explore`)
- Behavioral assertions
- Persona-specific findings

```bash
# Create contract-only baseline
bellwether baseline save --contract

# Full baseline with behavioral data (from explore)
bellwether explore
bellwether baseline save
```

## See Also

- [check](/cli/check) - Run checks to generate reports
- [upload](/cloud/upload) - Upload baseline to Bellwether Cloud
- [Drift Detection](/concepts/drift-detection) - Understanding baseline comparison
- [Baselines](/concepts/baselines) - Baseline concepts and best practices
- [CI/CD Integration](/guides/ci-cd) - Pipeline integration
